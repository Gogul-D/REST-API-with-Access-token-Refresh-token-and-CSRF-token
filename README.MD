# âœ… FULL SYSTEM TEST FLOW (Professional Way)

We will test:
Register
Login
Add Patient
Get Patients
Update Patient
Delete Patient
Access Token Expiry Test
Refresh Token Test
Csrf Token test

# ğŸ§ª CSFR Token Test in Postman

## 1ï¸âƒ£ Login

You will receive:

{
  "access_token": "...",
  "csrf_token": "abc123xyz..."
}

## 2ï¸âƒ£ For Creating Patient

Add headers:

Authorization: Bearer <access_token>
X-CSRF-Token: <csrf_token>
Content-Type: application/json

### Now it will work.

## âŒ If CSRF Missing (without csrf token )

You will get:

{
  "status": false,
  "message": "Invalid CSRF token"
}


### Correct behavior(Got error).

# Multi-user Isolation Test

## ğŸŸ¢ STEP 1 â€” Register User 1
POST
http://localhost/project/api/register

Body (JSON)
{
  "name": "User One",
  "email": "user1@test.com",
  "password": "123456"
}


### âœ… Expected:

User registered successfully

## ğŸŸ¢ STEP 2 â€” Login User 1
POST
http://localhost/project/api/login

Body:
{
  "email": "user1@test.com",
  "password": "123456"
}


### âœ… You should get:

access_token
expires_in


ğŸ” Copy the access_token

## ğŸŸ¢ STEP 3 â€” Add Patient (User 1)
POST
/api/patients

Authorization

Bearer Token â†’ paste access token

Body
{
  "name": "John Doe",
  "age": 30,
  "gender": "Male",
  "phone": "9876543210",
  "address": "Chennai"
}


### âœ… Expected:

Patient created successfully

## ğŸŸ¢ STEP 4 â€” Get Patients (User 1)
GET
/api/patients


Authorization: Bearer token

### âœ… You should see:

Only User 1's patients

## ğŸŸ¢ STEP 5 â€” Create User 2

Register another user:

{
  "name": "User Two",
  "email": "user2@test.com",
  "password": "123456"
}


Login user2 and copy access token.

## ğŸŸ¢ STEP 6 â€” Test User Isolation (IMPORTANT ğŸ”¥)

Login as User2.

GET
/api/patients


### âœ… Expected:

Empty list


User2 should NOT see User1's patients.

If this works â†’ Your security is correct.

## ğŸŸ¢ STEP 7 â€” Access Token Expiry Test (1 Minute)

Since you set:

JWT_EXPIRY = 60


Wait 1 minute.

Then try:

GET /api/patients


### âŒ Expected:

401 Invalid or expired token


âœ” That means access token works correctly.

## ğŸŸ¢ STEP 8 â€” Refresh Token Flow
POST
/api/refresh


(No body needed)

âš  IMPORTANT:
Cookies must be enabled in Postman.

### Expected:

Token refreshed successfully
New access token


Copy new access token.

Now test:

GET /api/patients


âœ… Should work again.

## ğŸŸ¢ STEP 9 â€” Logout Test
POST /api/logout


Then try:

POST /api/refresh


âŒ Expected:

Refresh token missing or invalid


System is secure.

## ğŸŸ¢ STEP 10 â€” Database Check

Check DB:

patients table

Each record should have:

user_id


Meaning data is linked to user correctly.

### ğŸŸ¢ FINAL SECURITY CHECK (Most Important)

Try this:

Login as User2
Try to update User1's patient ID.

PUT /api/patients/1


### âŒ Should fail.

If it updates â†’ SECURITY BUG âŒ
If it blocks â†’ PRODUCTION READY âœ”

